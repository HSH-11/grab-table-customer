<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Grab Table</title>
    <meta name="description" content="">
    <meta name="keywords" content="">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
          rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet">

</head>
<body class="index-page">
<header id="header" class="header position-relative">
    <div class="container-fluid container-xl position-relative">
        <div class="top-row d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-end">
                <h1 class="sitename">GrabTable</h1>
            </a>
        </div>
        <div class="nav-wrap">
            <div class="container d-flex justify-content-center position-relative">
                <nav id="navmenu" class="navmenu">
                    <ul>
                        <li><a href="/index" class="active">Home</a></li>
                        <li><a href="/register" id="registerLink">Register</a></li>
                        <li><a href="/login" id="loginLink">Login</a></li>
                        <li><a href="/reservation" id="reservationLink" style="display: none;">Reservation</a></li>
                        <li><a href="/mypage" id="mypageLink" style="display: none;">MyPage</a></li>
                        <li id="logoutLi" style="display: none;">
                            <form id="logoutForm" action="/logout" method="POST" style="margin: 0;">
                                <input type="hidden" name="_csrf" id="_csrf">
                                <button type="submit" style="background: none; border: none; color: #000000; cursor: pointer;">
                                    Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>
            </div>
        </div>
    </div>
</header>

<main class="main">
    <section id="blog-hero" class="blog-hero section">

        <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="blog-grid">
                <article class="blog-item featured" data-aos="fade-up">
                    <img src="assets/img/westernfood.jpg" alt="Blog Image" class="img-fluid">
                    <div class="blog-content">
                        <h2 class="post-title">
                            <a href="/category?type=양식" title="Western Food">Western</a>
                        </h2>
                    </div>
                </article>

                <article class="blog-item" data-aos="fade-up" data-aos-delay="100">
                    <img src="assets/img/KoreanFood.jpg" alt="Blog Image" class="img-fluid">
                    <div class="blog-content">
                        <h3 class="post-title">
                            <a href="/category?type=한식" title="Korean Food">Korean</a>
                        </h3>
                    </div>
                </article>

                <article class="blog-item" data-aos="fade-up" data-aos-delay="200">
                    <img src="assets/img/chinensefood.jpg" alt="Blog Image" class="img-fluid">
                    <div class="blog-content">
                        <h3 class="post-title">
                            <a href="/category?type=중식" title="chinense Food">Chinense</a>
                        </h3>
                    </div>
                </article>

                <article class="blog-item" data-aos="fade-up" data-aos-delay="300">
                    <img src="assets/img/japanensefood.jpeg" alt="Blog Image" class="img-fluid">
                    <div class="blog-content">
                        <h3 class="post-title">
                            <a href="/category?type=일식" title="Japanese Food">Japanese</a>
                        </h3>
                    </div>
                </article>

                <article class="blog-item" data-aos="fade-up" data-aos-delay="400">
                    <img src="assets/img/fusion.jpeg" alt="Blog Image" class="img-fluid">
                    <div class="blog-content">
                        <h3 class="post-title">
                            <a href="/category?type=퓨전" title="Fusion food">Fusion</a>
                        </h3>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <section id="latest-posts" class="latest-posts section">
        <div class="container section-title" data-aos="fade-up">
            <h2>Restaurants</h2>
            <div><span>Grab the</span> <span class="description-title">Restaurant</span></div>
        </div>
        <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="row gy-4" id="storeContainer"></div>
        </div>
    </section>
</main>
<footer>
    <div class="container copyright text-center mt-4">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">Blogy</strong> <span>All Rights Reserved</span></p>
        <div class="credits">
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </div>
</footer>

<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

<!-- Main JS File -->
<script src="assets/js/main.js"></script>


<!-- 가게 정보 불러오기 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/stores')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('storeContainer');
                const stores = data.storeDtoList || [];

                if (stores.length === 0) {
                    container.innerHTML = '<div class="col-12 text-center"><p>등록된 가게가 없습니다.</p></div>';
                    return;
                }

                stores.forEach(store => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-4';

                    const article = document.createElement('article');

                    const imgDiv = document.createElement('div');
                    imgDiv.className = 'post-img';
                    const img = document.createElement('img');
                    img.src = store.image && store.imageContentType
                        ? `data:${store.imageContentType};base64,${store.image}`
                        : 'https://via.placeholder.com/400x200?text=No+Image';
                    img.className = 'img-fluid';
                    imgDiv.appendChild(img);
                    article.appendChild(imgDiv);

                    const category = document.createElement('p');
                    category.className = 'post-category';
                    category.textContent = store.type;
                    article.appendChild(category);

                    const title = document.createElement('h2');
                    title.className = 'title';
                    const a = document.createElement('a');
                    a.href = `/store-detail?storeId=${store.storeId}`;
                    a.textContent = store.name;
                    title.appendChild(a);
                    article.appendChild(title);

                    const info = document.createElement('p');
                    info.className = 'card-text';
                    info.innerHTML = `
                        <strong>위치:</strong> ${store.location}`;
                    article.appendChild(info);

                    col.appendChild(article);
                    container.appendChild(col);
                });
            })
            .catch(error => {
                console.error('가게 목록 로드 실패:', error);
            });
    });

</script>


<script>
    window.onload = async function () {
        try {
            // CSRF 토큰
            const csrfRes = await fetch('/csrf-token', {credentials: 'same-origin'});
            const text = await csrfRes.text();

            if (text) {
                const csrfData = JSON.parse(text);
                document.querySelector('#_csrf').value = csrfData.token;
            } else {
                console.warn('CSRF 응답이 비어있습니다.');
            }

            // 로그인 확인
            const res = await fetch('/api/users', {credentials: 'same-origin'});
            console.log(res.status);
            if (res.status === 200) {
                // 로그인 상태일 때
                console.log("로그인 된 상태!");
                document.querySelector('#loginLink').style.display = 'none';
                document.querySelector('#registerLink').style.display = 'none';
                document.querySelector('#reservationLink').style.display = 'inline';
                document.querySelector('#mypageLink').style.display = 'inline';
                document.querySelector('#logoutLi').style.display = 'inline';
            } else if (res.status === 401) {
                // 비로그인 상태
                document.querySelector('#reservationLink').style.display = 'none';
                document.querySelector('#mypageLink').style.display = 'none';
                document.querySelector('#logoutLi').style.display = 'none';
            }

        } catch (err) {
            console.error('초기화 중 오류 발생:', err);
        }
    };

</script>
<script>
    AOS.init();
</script>

</body>
</html>
