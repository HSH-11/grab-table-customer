<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>예약 가능한 시간 조회</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #slotList {
      margin-top: 20px;
    }
    .slot {
      padding: 8px;
      border: 1px solid #ccc;
      margin-bottom: 5px;
      width: 200px;
    }
  </style>
</head>
<body>
<h2>예약 가능한 시간 조회</h2>

<label for="storeId">가게 ID:</label>
<input type="number" id="storeId" required>

<button onclick="loadAvailableSlots()">예약 시간 조회</button>

<div id="slotList"></div>

<script>
  async function loadAvailableSlots() {
    const storeId = document.getElementById("storeId").value;
    const slotList = document.getElementById("slotList");
    slotList.innerHTML = "";

    try {
      // 사용자 등급 정보 가져오기
      const userInfoRes = await fetch("/api/users/info", {
        credentials: 'include'
      });

      if (!userInfoRes.ok) throw new Error("사용자 정보를 불러올 수 없습니다.");

      const userInfo = await userInfoRes.json();
      const grade = userInfo.level.toLowerCase();

      console.log(grade);
      // 해당 등급으로 예약 가능한 시간 조회
      const slotRes = await fetch(`/api/${grade}/reservations/available-times?storeId=${storeId}`, {
        credentials: 'include'
      });

      if (!slotRes.ok) throw new Error("예약 가능 시간 조회 실패");

      const slots = await slotRes.json();

      if (slots.length === 0) {
        slotList.innerHTML = "<p>예약 가능한 시간이 없습니다.</p>";
        return;
      }

      slots.forEach(slot => {
        const div = document.createElement("div");
        div.className = "slot";
        div.innerText = `${slot.startTime} ~ ${slot.endTime}`;
        slotList.appendChild(div);
      });

    } catch (error) {
      console.error(error);
      slotList.innerHTML = `<p style="color:red;">에러 발생: ${error.message}</p>`;
    }
  }
</script>
</body>
</html>
